<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Wheel-CSV Drive Replay</title>
        <style>
            :root {
                color-scheme: dark;
            }
            body {
                margin: 0;
                font-family:
                    ui-sans-serif,
                    system-ui,
                    -apple-system;
                background: #0b0d10;
                color: #e8eef7;
            }
            header {
                padding: 10px 14px;
                display: flex;
                gap: 14px;
                align-items: center;
                flex-wrap: wrap;
                border-bottom: 1px solid #1b2330;
            }
            .group {
                display: flex;
                gap: 10px;
                align-items: center;
                flex-wrap: wrap;
            }
            label {
                font-size: 12px;
                opacity: 0.85;
                display: flex;
                gap: 6px;
                align-items: center;
            }
            input[type="number"] {
                width: 92px;
                padding: 6px 8px;
                background: #0f141b;
                color: #e8eef7;
                border: 1px solid #263246;
                border-radius: 10px;
            }
            input[type="range"] {
                width: min(520px, 75vw);
            }
            input[type="checkbox"] {
                transform: translateY(1px);
            }
            button {
                padding: 8px 12px;
                border-radius: 12px;
                border: 1px solid #2a3850;
                background: #121927;
                color: #e8eef7;
                cursor: pointer;
            }
            button:active {
                transform: translateY(1px);
            }
            .muted {
                opacity: 0.75;
                font-size: 12px;
            }
            .pill {
                padding: 6px 10px;
                border: 1px solid #263246;
                background: #0f141b;
                border-radius: 999px;
                font-size: 12px;
                opacity: 0.9;
            }
            #wrap {
                position: relative;
                height: calc(100vh - 86px);
            }
            canvas {
                width: 100%;
                height: 100%;
                display: block;
            }
            #hud {
                position: absolute;
                right: 10px;
                bottom: 10px;
                font-size: 12px;
                background: rgba(10, 14, 18, 0.75);
                border: 1px solid rgba(38, 50, 70, 0.7);
                padding: 10px 12px;
                border-radius: 12px;
                backdrop-filter: blur(6px);
                max-width: 380px;
            }
            #hud code {
                font-family:
                    ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
                font-size: 11px;
            }
            #dist_overlay {
                position: absolute;
                left: 10px;
                bottom: 10px;
                font:
                    13px ui-monospace,
                    SFMono-Regular,
                    Menlo,
                    Consolas,
                    monospace;
                background: rgba(10, 14, 18, 0.7);
                border: 1px solid rgba(38, 50, 70, 0.7);
                padding: 8px 10px;
                border-radius: 12px;
                backdrop-filter: blur(6px);
            }

            select {
                padding: 6px 8px;
                background: #0f141b;
                color: #e8eef7;
                border: 1px solid #263246;
                border-radius: 10px;
            }
        </style>
    </head>
    <body>
        <header>
            <div class="group">
                <input id="file" type="file" accept=".csv,text/csv" />
                <button id="btnPlay" disabled>Play</button>
                <button id="btnReset" disabled>Reset</button>
            </div>

            <div class="group">
                <label
                    >Speed
                    <input
                        id="speed"
                        type="number"
                        min="0.1"
                        step="0.1"
                        value="1.0"
                    />
                    <span class="muted">x</span>
                </label>
                <label
                    >Seek
                    <input
                        id="seek"
                        type="range"
                        min="0"
                        max="0"
                        value="0"
                        step="1"
                        disabled
                    />
                </label>
                <span id="seekLabel" class="muted">0 / 0</span>
            </div>

            <div class="group">
                <label
                    >Track (cm)
                    <input id="track" type="number" step="0.1" value="25" />
                </label>
                <label
                    >Wheelbase (cm)
                    <input id="wheelbase" type="number" step="0.1" value="43" />
                </label>
                <label
                    >Wheel circ. (cm)
                    <input id="circ" type="number" step="0.1" value="53" />
                </label>
                <label
                    >Pulses/rev
                    <input id="ppr" type="number" step="1" value="60" />
                </label>
            </div>

            <label
                >Yaw source
                <select id="yaw_source">
                    <option value="avg" selected>avg (left/right)</option>
                    <option value="rear">rear (RL/RR)</option>
                </select>
            </label>
            <label
                >Yaw gain
                <input id="yaw_gain" type="number" step="0.01" value="0.5" />
            </label>
            <label
                >ds blend α
                <input
                    id="ds_alpha"
                    type="number"
                    step="0.05"
                    min="0"
                    max="1"
                    value="0.30"
                />
                <span class="muted">0=rear, 1=all</span>
            </label>

            <div class="group">
                <label
                    ><input id="ghost_enabled" type="checkbox" checked />
                    Ghost</label
                >
                <label
                    >Horizon
                    <input
                        id="ghost_horizon"
                        type="number"
                        step="1"
                        min="1"
                        value="80"
                    />
                    <span class="muted">steps</span>
                </label>
                <label
                    >Max steer
                    <input
                        id="ghost_max_steer_deg"
                        type="number"
                        step="0.5"
                        value="17"
                    />
                    <span class="muted">deg</span>
                </label>
                <label
                    ><input id="ghost_flip_steer" type="checkbox" /> Flip
                    steer</label
                >
                <label
                    >Max accel
                    <input
                        id="ghost_max_accel"
                        type="number"
                        step="0.05"
                        value="0.8"
                    />
                    <span class="muted">m/s²</span>
                </label>
                <label
                    >Max decel
                    <input
                        id="ghost_max_decel"
                        type="number"
                        step="0.05"
                        value="1.5"
                    />
                    <span class="muted">m/s²</span>
                </label>
                <label
                    ><input id="ghost_use_gear" type="checkbox" checked /> Use
                    gear</label
                >

                <label
                    ><input id="ghost_flip_torque" type="checkbox" /> Flip
                    torque</label
                >
                <label
                    >Drag
                    <input
                        id="ghost_drag"
                        type="number"
                        step="0.01"
                        value="0.15"
                    />
                    <span class="muted">1/s</span>
                </label>
                <label>Roll res
                    <input id="ghost_roll" type="number" value="0.5" step="0.05" min="0" />
                    <span class="muted">m/s²</span>
                </label>
                <label
                    >Deadzone
                    <input
                        id="ghost_deadzone"
                        type="number"
                        step="1"
                        value="10"
                    />
                    <span class="muted">t units</span>
                </label>
                <label
                    >Include in zoom
                    <input id="ghost_include_zoom" type="checkbox" checked />
                </label>
                <label
                    >Opacity
                    <input
                        id="ghost_alpha"
                        type="number"
                        step="0.02"
                        min="0"
                        max="1"
                        value="0.22"
                    />
                </label>
            </div>
        </header>

        <div id="wrap">
            <canvas id="c"></canvas>
            <div id="dist_overlay">Distance: 0.00 m</div>
            <div id="hud">
                <div><b>Status:</b> <span id="status">Load a CSV.</span></div>
                <div>
                    <b>Pose:</b> <code id="pose">x=0.0cm y=0.0cm θ=0.0°</code>
                </div>
                <div><b>Step:</b> <code id="step">dt=0ms</code></div>
            </div>
        </div>

        <script src="./sim.js"></script>
    </body>
</html>
